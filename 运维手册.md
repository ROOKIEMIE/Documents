# 运维手册

## Ubuntu配置

### VMWare tools安装中报错

```shell
sudo apt-get remove open-vm-tools --purge
sudo apt-get remove open-vm-tools-desktop --purge
sudo vmware-install.pl
sudo apt-get install open-vm-tools open-vm-tools-desktop
```



## 配置SSH

### SSH配置文件

环境：Ubuntu18.04

SSH配置文件路径：``` /etc/ssh/sshd_config ```

|         配置项         |          值          | 备注                                                         |
| :--------------------: | :------------------: | :----------------------------------------------------------- |
|          Port          |          22          | 用来设置sshd监听的端口(修改了这个参数后最好把下面的 ``` ListenAddress ```也打开，使用0.0.0.0) |
|        Protocol        |          2           | 设置使用ssh协议的版本为SSH1或者SSH2 SSH1有版本漏洞所以设置2  |
|     ListenAddress      |       0.0.0.0        | 用来设置ssh服务绑定的IP地址                                  |
|     ServerKeyBits      |         1024         | 密钥的长度                                                   |
|        LogLevel        |         INFO         | 记录ssh日志消息级别                                          |
|     LoginGraceTime     |          2m          | 用户登入失败，切断连接等待时间                               |
|    PermitRootLogin     |         yes          | 设置不能root远程登入服务器                                   |
|  PubkeyAuthentication  |         yes          | 设置是否公钥验证                                             |
|   RSAAuthentication    |         yes          | 是否设置RSA密钥验证(SSH2后弃用，弃用后只需要启动公钥验证即可，否则在连接时会报 ==*reprocess config line 38: Deprecated option RSAAuthentication*== 的错误) |
|   AuthorizedKeysFile   | .ssh/authorized_keys | 设置公钥验证文件路径                                         |
| PasswordAuthentication |         yes          | 登录时候开启密码验证                                         |
|  PermitEmptyPasswords  |          no          | 设置是否允许空口令帐号登入系统                               |
|      MaxStartups       |      10:30:100       | 设置允许几个尚未登入的联机                                   |

### SSH在服务器端生成密钥对

``` shell
[root@host ~]$ ssh-keygen  <== 建立密钥对
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): <== 按 Enter
Created directory '/root/.ssh'.
Enter passphrase (empty for no passphrase): <== 输入密钥锁码，或直接按 Enter 留空
Enter same passphrase again: <== 再输入一遍密钥锁码
Your identification has been saved in /root/.ssh/id_rsa. <== 私钥
Your public key has been saved in /root/.ssh/id_rsa.pub. <== 公钥
The key fingerprint is: <==密钥的指纹
0f:d3:e7:1a:1c:bd:5c:03:f1:19:f1:22:df:9b:cc:08 root@host
```

### SSH密钥存放位置

环境：Ubuntu18.04

路径：/root/.ssh/

> PS：将密钥存放于此后，记得回去修改配置文件中的公钥验证文件，将密钥文件名添加至``` AuthorizedKeysFile ```配置后



## 安装配置Maven



## Linux下的网络配置

>  Ubuntu

适用于18.04及以上版本

找到``` /etc/netplan/01-network-manager.yaml ```

默认配置如下：

```yaml
# Let NetworkManager manage all devices on this system
network:
  version: 2
  renderer: NetworkManager
```

若需要配置系统为某静态IP，则可以通过修改该配置文件实现，**配置前请做好配置文件的备份!!!**，以下仅给出一个示例，具体配置时需根据具体的网络情况配置其中的addresses、routes、nameservers等值，**注意yaml配置文件的缩进**，不正确的缩进将导致配置不可用。

```yaml
network:
    ethernets:
      ens39:
        dhcp4: false
        addresses: 
          - 192.168.211.156/24
        routes: 
          - to: default
            via: 192.168.211.2
        nameservers: 
          addresses: 
            - 8.8.8.8
            - 114.114.114.114
            - 192.168.211.1
    version: 2
    renderer: NetworkManage
```

修改后需执行以下命令：

```shell
sudo netplan apply
```

设置代理环境变量

```shell
export <PATH-name>=""
```



## Windows下的网络配置

查看端口占用

```cmd
netstat -ano|findstr <select-port>
```



## docker常用命令



```shell
docker pull <image name>

docker run -it <image id> /bin/sh
```



## 常用的Shell命令组合

> 将find命令所找的文件都拷贝到一个临时目录中

```shell
mkdir -p tmp && find ./ -name "*.*" | xargs -I {} cp {} ./tmp
# 如果文件路径中包含特殊字符（如空格、引号等），xargs可能不好处理，可以直接适用以下命令
mkdir -p tmp && find ./ -name "*.*" -exec cp {} ./tmp \;
```

注：

1. mkdir中的``` -p  ```参数可以保证不会因为重复创建目录而报错
2. xargs分割输入字符串的方式有根据制表符（tab）、空格以及换行符，因此上述中第一条命令中适用的xargs的``` -I ```参数也可以用于处理适用空格或缩进分隔的输入字符串
3. 给出的第二个命令中``` -exec ```参数为find命令的参数，其会将find所找到的每个结果都替换到后面的``` {} ```占位符中
4. 给出的第二个命令的最后适用``` \; ```来告诉``` -exec ```这是命令的结束

> 为一个文件夹下的所有子文件中都添加一个名为xxx的文件

```shell
find . -type d -exec touch {}/xxx \;
```



> 压缩/解压缩

tar 压缩

```shell
tar -cvf archive.tar directory  # 创建一个名为archive.tar的归档文件，包含"directory"目录
tar -czvf archive.tar.gz directory  # 创建一个使用gzip压缩的归档文件
tar -cjvf archive.tar.bz2 directory  # 创建一个使用bzip2压缩的归档文件
```

tar 解压缩

```shell
tar -xvf archive.tar  # 解压archive.tar到当前目录
tar -xzvf archive.tar.gz  # 解压gzip压缩的归档文件
tar -xjvf archive.tar.bz2  # 解压bzip2压缩的归档文件
```

zip 压缩

```shell
zip archive.zip file  # 把文件压缩为archive.zip
zip -r archive.zip directory  # 把整个目录压缩为archive.zip
```

unzip 解压缩

```shell
unzip archive.zip  # 解压archive.zip到当前目录
```



## 常用的Window下的命令使用

查看进程

```cmd
# 过滤进程列表
tasklist | findstr "notepad.exe"
```

杀死进程

```cmd
# 通过进程名终结进程
taskkill /IM notepad.exe /F
# 通过PID终结进程
taskkill /PID 1234 /F
```

cmd下的环境变量使用

```cmd
echo %CMDCMDLINE%
```

powershell下的环境变量使用

```powershell
echo $env:USERPROFILE
echo $env:HTTP_PROXY
echo $env:HTTPS_PROXY
# 设置代理
$env:HTTP_PROXY = "http://proxyserver:port"
$env:HTTPS_PROXY = "http://proxyserver:port"
# 禁用代理
$env:HTTP_PROXY = $null
$env:HTTPS_PROXY = $null
```

通过powershell获取进程列表

```powershell
Get-Process
# Get-Process也支持通过管道符过滤结果
Get-Process | findstr "notepad.exe"
```

